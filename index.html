<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Bengt’s Wish List</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display&family=Roboto&display=swap" rel="stylesheet" />
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<style>
  /* Reset & Basics */
  *, *::before, *::after {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }
  html, body {
    margin: 0; padding: 0;
    font-family: 'Roboto', sans-serif;
    background-color: #000;
    color: #fff;
    height: 100%;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  a {
    color: #ffd700cc;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }

  /* Header */
  header {
    position: sticky;
    top: 0;
    background: rgba(0,0,0,0.95);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1rem 0.8rem;
    z-index: 1100;
  }
  .title {
    font-family: 'Playfair Display', serif;
    font-size: 1.7rem;
    background: linear-gradient(270deg, #ffd700, #fff4b2, #ffd700);
    background-size: 200% 100%;
    background-clip: text;
    -webkit-background-clip: text;
    color: transparent;
    animation: shimmer 6s linear infinite, floatTitle 4s ease-in-out infinite;
    user-select: none;
  }
  @keyframes shimmer {
    0% { background-position: 200% center; }
    100% { background-position: -200% center; }
  }
  @keyframes floatTitle {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-3px); }
  }

  /* Buttons */
  .control-buttons {
    display: flex;
    gap: 0.6rem;
  }
  button.action-button {
    background: #1f1f1f;
    color: #ffd700;
    border: 1.5px solid #ffd700;
    padding: 0.45rem 1.2rem;
    border-radius: 12px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    user-select: none;
  }
  button.action-button:hover, button.action-button:focus {
    background: #ffd700;
    color: #000;
    box-shadow: 0 0 12px #ffd700;
    outline: none;
  }

  /* Tabs for categories */
  .tabs {
    display: flex;
    overflow-x: auto;
    background: #111;
    padding: 0.5rem 0.25rem;
    user-select: none;
    border-bottom: 1px solid #333;
  }
  .tab {
    padding: 0.5rem 1rem;
    cursor: pointer;
    color: #ddd;
    white-space: nowrap;
    border-bottom: 3px solid transparent;
    transition: border-color 0.3s ease, color 0.3s ease;
  }
  .tab.active {
    border-bottom-color: #ffd700;
    font-weight: 700;
    color: #ffd700;
  }
  .tab:hover:not(.active) {
    color: #fff;
  }

  /* Main content grid */
  main {
    padding: 1rem;
    margin-top: 0.6rem;
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  @media (min-width: 600px) {
    main {
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
  }

  /* Product Card */
  .card {
    background: #111;
    border-radius: 14px;
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.1);
    position: relative;
    cursor: pointer;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    user-select: none;
  }
  .card img {
    width: 100%;
    height: 190px;
    object-fit: cover;
    border-top-left-radius: 14px;
    border-top-right-radius: 14px;
    pointer-events: none;
    user-select: none;
  }
  .card-content {
    padding: 1rem 1rem 1.3rem 1rem;
  }
  .card-content h3 {
    margin: 0;
    font-weight: 700;
    font-size: 1.15rem;
    color: #fff;
  }
  .price {
    color: #ffd700cc;
    font-weight: 700;
    margin-top: 0.3rem;
    text-shadow: 0 0 6px #ffd70099;
  }
  .notes {
    margin-top: 0.4rem;
    font-size: 0.9rem;
    color: #ddd;
    font-style: italic;
  }
  .priority {
    margin-top: 0.3rem;
    font-size: 0.85rem;
    font-weight: 600;
    color: #ffc107cc;
  }

  /* Delete Button */
  .delete-btn {
    display: none; /* Hidden by default, shown after auth */
    position: absolute;
    top: 12px;
    right: 12px;
    background: rgba(0, 0, 0, 0.6);
    color: #fff;
    border: none;
    border-radius: 50%;
    padding: 0.35rem 0.4rem;
    cursor: pointer;
    z-index: 10;
    transition: transform 0.2s ease, background-color 0.3s ease, color 0.3s ease;
    user-select: none;
  }
  .delete-btn:hover, .delete-btn:focus {
    transform: scale(1.3);
    background: #ffd700;
    color: #000;
    outline: none;
  }

  /* Highlight on pointer down */
  .card:active {
    /* No pulse, only scale + glow on pointer down */
    transform: scale(1.03);
    box-shadow: 0 0 20px #ffd700;
  }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.85);
    justify-content: center;
    align-items: center;
    z-index: 2000;
    user-select: none;
  }
  .modal.active {
    display: flex;
  }
  .modal-content {
    background: #222;
    padding: 1.5rem 1.8rem;
    border-radius: 14px;
    width: 90%;
    max-width: 440px;
    animation: fadeInScale 0.4s ease forwards;
    user-select: text;
  }
  @keyframes fadeInScale {
    from { opacity: 0; transform: scale(0.8); }
    to { opacity: 1; transform: scale(1); }
  }
  .modal-content label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.3rem;
    color: #ffd700cc;
  }
  .modal-content input, .modal-content textarea, .modal-content select {
    width: 100%;
    padding: 0.5rem 0.7rem;
    margin-bottom: 1rem;
    border: none;
    border-radius: 7px;
    background: #333;
    color: #fff;
    font-size: 1rem;
    font-family: 'Roboto', sans-serif;
    transition: background-color 0.3s ease;
  }
  .modal-content input:focus, .modal-content textarea:focus, .modal-content select:focus {
    outline: 2px solid #ffd700;
    background-color: #444;
  }
  .modal-content textarea {
    resize: vertical;
    min-height: 60px;
  }
  .modal-content button {
    background: #ffd700;
    border: none;
    color: #000;
    padding: 0.65rem 1.2rem;
    border-radius: 8px;
    font-weight: 700;
    font-size: 1.1rem;
    cursor: pointer;
    user-select: none;
    transition: box-shadow 0.3s ease;
  }
  .modal-content button:hover, .modal-content button:focus {
    box-shadow: 0 0 15px #ffd700;
    outline: none;
  }

  /* Sticky Add button */
  #add-btn {
    position: fixed;
    bottom: 16px;
    right: 16px;
    z-index: 1500;
    display: none; /* Only visible after auth */
    box-shadow: 0 0 15px #ffd700cc;
    font-size: 1.8rem;
    padding: 0.5rem 0.75rem;
    border-radius: 50%;
    background: #1f1f1f;
    border: 2px solid #ffd700;
    color: #ffd700;
    cursor: pointer;
    user-select: none;
    transition: all 0.3s ease;
  }
  #add-btn:hover, #add-btn:focus {
    background: #ffd700;
    color: #000;
    box-shadow: 0 0 25px #ffd700;
    outline: none;
  }

  /* Pull to Refresh indicator */
  #pull-to-refresh {
    position: fixed;
    top: -50px;
    left: 50%;
    transform: translateX(-50%);
    color: #ffd700cc;
    font-weight: 700;
    font-size: 1.1rem;
    user-select: none;
    pointer-events: none;
    z-index: 2500;
    transition: top 0.3s ease;
  }

  /* Toast notifications */
  #toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: #ffd700dd;
    color: #000;
    padding: 0.8rem 1.3rem;
    border-radius: 18px;
    font-weight: 600;
    font-size: 1rem;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
    user-select: none;
    z-index: 3000;
  }
  #toast.show {
    opacity: 1;
    pointer-events: auto;
  }

  /* QR Code modal */
  #qr-modal .modal-content {
    max-width: 320px;
    text-align: center;
  }
  #qr-code {
    margin: 0 auto 1rem;
    width: 200px;
    height: 200px;
  }

  /* Scrollbar styles for tabs (optional) */
  .tabs::-webkit-scrollbar {
    height: 6px;
  }
  .tabs::-webkit-scrollbar-thumb {
    background: #ffd70055;
    border-radius: 4px;
  }

</style>
</head>
<body>
<header>
  <div class="title">Bengt’s Wish List</div>
  <div class="control-buttons">
    <button id="edit-toggle" class="action-button" aria-pressed="false" aria-label="Bearbeitungsmodus ein-/ausschalten">Bearbeiten</button>
    <button id="add-btn" aria-label="Produkt hinzufügen"><i class="fas fa-plus"></i></button>
  </div>
</header>

<div class="tabs" role="tablist" aria-label="Produktkategorien">
  <div class="tab active" role="tab" tabindex="0" aria-selected="true" data-category="All">All</div>
  <div class="tab" role="tab" tabindex="0" aria-selected="false" data-category="Elektronik">Elektronik</div>
  <div class="tab" role="tab" tabindex="0" aria-selected="false" data-category="Mode">Mode</div>
  <div class="tab" role="tab" tabindex="0" aria-selected="false" data-category="Schmuck">Schmuck</div>
</div>

<main id="product-list" role="region" aria-live="polite" aria-label="Produktliste"></main>

<div id="pull-to-refresh">⇣ Pull to Refresh</div>

<!-- Add / Edit Modal -->
<div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1">
  <div class="modal-content">
    <h2 id="modal-title" style="color:#ffd700; margin-top:0; margin-bottom:1rem;">Produkt hinzufügen</h2>
    <label for="imgUrl">Bild URL</label>
    <input type="url" id="imgUrl" placeholder="https://example.com/image.jpg" autocomplete="off" />
    <label for="name">Name</label>
    <input type="text" id="name" placeholder="Produktname" autocomplete="off" />
    <label for="price">Preis</label>
    <input type="text" id="price" placeholder="z.B. €79.99" autocomplete="off" />
    <label for="link">Shop URL</label>
    <input type="url" id="link" placeholder="https://shop.example.com" autocomplete="off" />
    <label for="category-select">Kategorie</label>
    <select id="category-select" aria-label="Produktkategorie auswählen">
      <option value="Elektronik">Elektronik</option>
      <option value="Mode">Mode</option>
      <option value="Schmuck">Schmuck</option>
      <option value="All">Andere</option>
    </select>
    <label for="notes">Notizen (optional)</label>
    <textarea id="notes" placeholder="Zusätzliche Infos"></textarea>
    <label for="priority">Priorität</label>
    <select id="priority" aria-label="Priorität auswählen">
      <option value="Hoch">Hoch</option>
      <option value="Mittel" selected>Mittel</option>
      <option value="Niedrig">Niedrig</option>
    </select>
    <button id="save-product-btn">Speichern</button>
  </div>
</div>

<!-- QR Code Modal -->
<div class="modal" id="qr-modal" role="dialog" aria-modal="true" aria-labelledby="qr-modal-title" tabindex="-1">
  <div class="modal-content">
    <h2 id="qr-modal-title" style="color:#ffd700; margin-top:0; margin-bottom:1rem;">Teilen</h2>
    <canvas id="qr-code"></canvas>
    <button id="close-qr">Schließen</button>
  </div>
</div>

<!-- Toast Notification -->
<div id="toast" role="alert" aria-live="assertive"></div>

<script>
  // --------- Firebase setup ---------
  const firebaseConfig = {
    // Deine Firebase-Daten hier einfügen
    apiKey: "AIzaSyAmGhT9CjCMoICHA-B6w28_eGZqsq7dfpM",
    authDomain: "bengts-wishlist.firebaseapp.com",
    databaseURL: "https://bengts-wishlist-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "bengts-wishlist",
    storageBucket: "bengts-wishlist.firebasestorage.app",
    messagingSenderId: "292890468669",
    appId: "1:292890468669:web:1cd0a2399d99c00d10e554"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Globale Variablen
  const productList = document.getElementById('product-list');
  const modal = document.getElementById('modal');
  const qrModal = document.getElementById('qr-modal');
  const qrCanvas = document.getElementById('qr-code');
  const addBtn = document.getElementById('add-btn');
  const editToggleBtn = document.getElementById('edit-toggle');
  const toast = document.getElementById('toast');
  const pullToRefresh = document.getElementById('pull-to-refresh');

  const password = "bengtpw";
  let authenticated = false;
  let currentCategory = 'All';

  // Toast anzeigen
  function showToast(message, duration=2500) {
    toast.textContent = message;
    toast.classList.add('show');
    setTimeout(() => {
      toast.classList.remove('show');
    }, duration);
  }

  // Auth-Status anpassen UI
  function checkAuth() {
    if(authenticated){
      addBtn.style.display = 'block';
      document.querySelectorAll('.delete-btn').forEach(btn => btn.style.display = 'block');
      editToggleBtn.textContent = "Bearbeiten (AN)";
      editToggleBtn.setAttribute('aria-pressed', 'true');
    } else {
      addBtn.style.display = 'none';
      document.querySelectorAll('.delete-btn').forEach(btn => btn.style.display = 'none');
      editToggleBtn.textContent = "Bearbeiten";
      editToggleBtn.setAttribute('aria-pressed', 'false');
    }
  }

  // Bearbeitungsmodus togglen mit Passwort
  editToggleBtn.addEventListener('click', () => {
    if(authenticated){
      authenticated = false;
      showToast("Bearbeitungsmodus deaktiviert");
      checkAuth();
    } else {
      const entered = prompt("Bitte Passwort eingeben:");
      if(entered === password){
        authenticated = true;
        showToast("Bearbeitungsmodus aktiviert");
        checkAuth();
      } else {
        showToast("Falsches Passwort");
      }
    }
  });

  // Modal öffnen & schließen
  addBtn.addEventListener('click', () => openModal());
  function openModal() {
    modal.classList.add('active');
    // Reset inputs
    modal.querySelector('#imgUrl').value = '';
    modal.querySelector('#name').value = '';
    modal.querySelector('#price').value = '';
    modal.querySelector('#link').value = '';
    modal.querySelector('#category-select').value = 'All';
    modal.querySelector('#notes').value = '';
    modal.querySelector('#priority').value = 'Mittel';
    modal.focus();
  }
  function closeModal() {
    modal.classList.remove('active');
  }
  modal.addEventListener('click', e => {
    if(e.target === modal) closeModal();
  });
  document.addEventListener('keydown', e => {
    if(e.key === "Escape" && modal.classList.contains('active')) closeModal();
    if(e.key === "Escape" && qrModal.classList.contains('active')) qrModal.classList.remove('active');
  });

  // Produkt speichern in Firebase
  const saveBtn = modal.querySelector('#save-product-btn');
  saveBtn.addEventListener('click', () => {
    const product = {
      imgUrl: modal.querySelector('#imgUrl').value.trim() || 'https://via.placeholder.com/300x190?text=Kein+Bild',
      name: modal.querySelector('#name').value.trim(),
      price: modal.querySelector('#price').value.trim(),
      link: modal.querySelector('#link').value.trim(),
      category: modal.querySelector('#category-select').value,
      notes: modal.querySelector('#notes').value.trim(),
      priority: modal.querySelector('#priority').value
    };
    if(!product.name || !product.price) {
      showToast("Name und Preis sind Pflichtfelder!");
      return;
    }
    db.ref('wishlist').push(product, error => {
      if(error){
        showToast("Fehler beim Speichern");
      } else {
        showToast("Produkt hinzugefügt");
        closeModal();
      }
    });
  });

  // Produktkarte erstellen & anhängen
  function createCard(key, product) {
    const { imgUrl, name, price, link, category, notes, priority } = product;
    const card = document.createElement('article');
    card.className = 'card';
    card.setAttribute('tabindex', '0');
    card.setAttribute('aria-label', `${name}, Preis ${price}, Kategorie ${category}`);

    // Card innerHTML mit Button
    card.innerHTML = `
      <button class="delete-btn" aria-label="Löschen" title="Löschen">
        <i class="fas fa-trash"></i>
      </button>
      <img src="${imgUrl}" alt="Bild von ${name}" loading="lazy" />
      <div class="card-content">
        <h3>${name}</h3>
        <p class="price">${price}</p>
        ${notes ? `<p class="notes">${notes}</p>` : ''}
        <p class="priority">Priorität: ${priority}</p>
        <button class="share-btn" aria-label="Teilen"><i class="fas fa-share-alt"></i></button>
      </div>
    `;

    // Delete Button event
    const deleteBtn = card.querySelector('.delete-btn');
    deleteBtn.addEventListener('click', e => {
      e.stopPropagation();
      if(!authenticated){
        showToast("Bitte zuerst bearbeiten aktivieren");
        return;
      }
      confirmDelete(key);
    });

    // Share Button event
    const shareBtn = card.querySelector('.share-btn');
    shareBtn.addEventListener('click', e => {
      e.stopPropagation();
      openShareModal(key, product);
    });

    // Card click öffnet Shop-Link (außer delete oder share)
    card.addEventListener('click', e => {
      if(e.target.closest('button')) return;
      if(link) window.open(link, '_blank', 'noopener');
    });

    // Fingerpress Highlight (Glow & Scale)
    card.addEventListener('pointerdown', e => {
      if(e.pointerType === 'touch' || e.pointerType === 'pen'){
        navigator.vibrate?.(10);
        gsap.to(card, { scale:1.03, boxShadow:"0 0 20px #ffd700", duration: 0.25, ease:"power1.out" });
      }
    });
    ['pointerup','pointercancel','pointerleave'].forEach(evt => {
      card.addEventListener(evt, e => {
        if(e.pointerType === 'touch' || e.pointerType === 'pen'){
          gsap.to(card, { scale:1, boxShadow:"0 0 10px rgba(255,215,0,0.1)", duration: 0.3 });
        }
      });
    });

    // Swipe to delete support (touch only)
    let startX = 0;
    let currentX = 0;
    let swiping = false;

    card.addEventListener('touchstart', e => {
      startX = e.touches[0].clientX;
      swiping = true;
      card.style.transition = 'none';
    });

    card.addEventListener('touchmove', e => {
      if(!swiping) return;
      currentX = e.touches[0].clientX;
      let deltaX = currentX - startX;
      if(deltaX < 0) { // nur nach links swipen erlaubt
        e.preventDefault();
        card.style.transform = `translateX(${deltaX}px)`;
      }
    }, { passive: false });

    card.addEventListener('touchend', e => {
      if(!swiping) return;
      swiping = false;
      let deltaX = currentX - startX;
      card.style.transition = 'transform 0.3s ease';

      if(deltaX < -100) {
        card.style.transform = `translateX(-100%)`;
        showUndoDelete(key, card);
      } else {
        card.style.transform = 'translateX(0)';
      }
    });

    return card;
  }

  // Produkte laden & filtern
  function loadProducts(category = 'All') {
    currentCategory = category;
    // Tabs active state
    document.querySelectorAll('.tab').forEach(tab => {
      tab.classList.toggle('active', tab.dataset.category === category);
      tab.setAttribute('aria-selected', tab.dataset.category === category);
    });

    db.ref('wishlist').once('value', snapshot => {
      const data = snapshot.val() || {};
      productList.innerHTML = '';
      const keys = Object.keys(data);

      // Sortieren: Priorität (Hoch > Mittel > Niedrig), dann Name A-Z
      const priorityOrder = { Hoch: 3, Mittel: 2, Niedrig: 1 };
      keys.sort((a,b) => {
        const pA = priorityOrder[data[a].priority] || 0;
        const pB = priorityOrder[data[b].priority] || 0;
        if(pB !== pA) return pB - pA;
        return (data[a].name.localeCompare(data[b].name));
      });

      keys.forEach(key => {
        const product = data[key];
        if(category === 'All' || product.category === category){
          productList.appendChild(createCard(key, product));
        }
      });
    });
  }

  // Undo Delete mit Animation & Timer
  let undoTimeout = null;
  function showUndoDelete(key, card) {
    if(!authenticated) return;

    // Produkt vorübergehend verstecken (nicht löschen)
    card.style.pointerEvents = 'none';
    card.style.opacity = '0.4';

    // Toast mit Undo Button
    toast.innerHTML = `
      Produkt wird gelöscht. 
      <button id="undo-btn" style="background:none;border:none;color:#000;font-weight:700;cursor:pointer;">Rückgängig</button>
    `;
    toast.classList.add('show');

    // Undo Button Event
    document.getElementById('undo-btn').onclick = () => {
      clearTimeout(undoTimeout);
      toast.classList.remove('show');
      card.style.pointerEvents = 'auto';
      card.style.opacity = '1';
      card.style.transition = 'transform 0.3s ease';
      card.style.transform = 'translateX(0)';
      showToast("Löschen abgebrochen");
    };

    // Nach 3 Sekunden löschen
    undoTimeout = setTimeout(() => {
      toast.classList.remove('show');
      db.ref('wishlist/' + key).remove();
      showToast("Produkt gelöscht");
    }, 3000);
  }

  // Delete mit Bestätigung
  function confirmDelete(key) {
    if(confirm("Produkt wirklich löschen?")){
      db.ref('wishlist/' + key).remove();
    }
  }

  // QR Code Modal für Teilen öffnen
  function openShareModal(key, product){
    qrModal.classList.add('active');
    const shareUrl = `${location.origin}${location.pathname}?product=${key}`;
    QRCode.toCanvas(qrCanvas, shareUrl, { width: 200 }, err => {
      if(err) {
        console.error(err);
        showToast("QR-Code Fehler");
      }
    });
  }
  document.getElementById('close-qr').addEventListener('click', () => {
    qrModal.classList.remove('active');
  });
  qrModal.addEventListener('click', e => {
    if(e.target === qrModal) qrModal.classList.remove('active');
  });

  // Listen auf Firebase Änderungen
  db.ref('wishlist').on('value', () => {
    loadProducts(currentCategory);
  });

  // Kategorie Tabs Events
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => loadProducts(tab.dataset.category));
    tab.addEventListener('keydown', e => {
      if(e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        loadProducts(tab.dataset.category);
        tab.focus();
      }
    });
  });

  // Pull to Refresh Logik
  let startY = 0;
  let pullDistance = 0;
  let refreshing = false;
  document.body.addEventListener('touchstart', e => {
    if(document.scrollingElement.scrollTop === 0){
      startY = e.touches[0].clientY;
      pullDistance = 0;
    }
  });
  document.body.addEventListener('touchmove', e => {
    if(document.scrollingElement.scrollTop === 0 && !refreshing){
      const currentY = e.touches[0].clientY;
      pullDistance = Math.max(0, currentY - startY);
      if(pullDistance > 0){
        e.preventDefault();
        pullToRefresh.style.top = Math.min(pullDistance - 50, 60) + 'px';
        if(pullDistance > 50){
          pullToRefresh.textContent = '⇣ Lass los zum Aktualisieren';
        } else {
          pullToRefresh.textContent = '⇣ Ziehe nach unten zum Aktualisieren';
        }
      }
    }
  }, { passive: false });
  document.body.addEventListener('touchend', e => {
    if(pullDistance > 50 && !refreshing){
      refreshing = true;
      pullToRefresh.textContent = '⟳ Aktualisiere...';
      pullToRefresh.style.top = '10px';
      // refresh Firebase data
      db.ref('wishlist').once('value').then(() => {
        setTimeout(() => {
          refreshing = false;
          pullToRefresh.style.top = '-50px';
          showToast("Aktualisiert");
        }, 1000);
      });
    } else {
      pullToRefresh.style.top = '-50px';
    }
  });

  // URL Parameter Produkt Detail Handling (Optional Erweiterung)
  function handleURLParams(){
    const params = new URLSearchParams(window.location.search);
    const prodKey = params.get('product');
    if(prodKey){
      db.ref('wishlist/' + prodKey).once('value').then(snap => {
        const product = snap.val();
        if(product){
          openShareModal(prodKey, product);
        }
      });
    }
  }
  handleURLParams();

  // Initial load
  loadProducts();

</script>
</body>
</html>
