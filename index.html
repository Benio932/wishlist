<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Bengt’s Wish List — Ultimate Mobile Motion</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

<!-- GSAP + ScrollTrigger CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

<!-- Firebase modular -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  import { getDatabase } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";
  // Expose minimal firebase to window for later inline module usage
  window._fb = { initializeApp, getDatabase };
</script>

<style>
  /* =========================
     Mobile-first Premium Styles
     ========================= */
  :root{
    --accent:#d4af37;
    --accent-2:#ffd87a;
    --bg-1:#070708;
    --bg-2:#0f1112;
    --muted:#9aa0a6;
    --card-radius:16px;
    --glass: rgba(255,255,255,0.03);
    --max-width:900px;
  }
  html,body{height:100%; margin:0; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; background: linear-gradient(180deg,var(--bg-1),var(--bg-2)); color:#eef0f2; font-family:Roboto,system-ui,-apple-system,Arial; }
  .app { max-width:var(--max-width); margin:0 auto; padding:14px 12px 90px; box-sizing:border-box; position:relative; overflow-x:hidden; }

  /* Ambient Canvas on full-screen (behind everything) */
  canvas#ambient { position:fixed; inset:0; z-index:0; pointer-events:none; filter:blur(12px) saturate(1.05); opacity:0.85; }

  /* Header (compact, mobile-first) */
  header.app-header {
    position:sticky; top:8px; z-index:30; display:flex; align-items:center; justify-content:space-between; gap:8px;
    padding:12px; border-radius:14px; backdrop-filter: blur(8px) saturate(1.05);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.03);
    box-shadow: 0 10px 40px rgba(0,0,0,0.55);
  }
  .brand { display:flex; flex-direction:column; gap:3px; }
  .brand h1 {
    margin:0; font-family: 'Playfair Display', serif; font-weight:600; font-size:18px;
    background: linear-gradient(90deg,var(--accent),var(--accent-2), #fff);
    -webkit-background-clip:text; background-clip:text; color:transparent;
    letter-spacing:-0.01em;
  }
  .brand p { margin:0; font-size:12px; color:var(--muted); }

  .controls { display:flex; gap:8px; align-items:center; }

  .btn {
    display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:10px; font-weight:700; cursor:pointer;
    background: rgba(255,255,255,0.02); color:var(--accent); border:1px solid rgba(255,255,255,0.03);
    box-shadow: 0 6px 22px rgba(0,0,0,0.45);
    transform-origin:center;
  }
  .btn.ghost { color:#ddd; background:transparent; border:1px dashed rgba(255,255,255,0.02); }

  /* Motion toggle small */
  .motion-toggle { display:flex; align-items:center; gap:6px; font-size:13px; color:var(--muted); }
  .motion-toggle input { width:44px; height:24px; appearance:none; background:rgba(255,255,255,0.03); border-radius:999px; position:relative; border:1px solid rgba(255,255,255,0.02); cursor:pointer; }
  .motion-toggle input::after { content:''; position:absolute; width:18px; height:18px; border-radius:50%; background:#fff; top:2px; left:2px; transition: transform .22s cubic-bezier(.2,.9,.2,1); box-shadow: 0 6px 18px rgba(0,0,0,0.4); }
  .motion-toggle input:checked { background: linear-gradient(90deg,var(--accent),var(--accent-2)); }
  .motion-toggle input:checked::after { transform: translateX(20px); }

  /* Hero / Intro area (mobile-first) */
  .hero {
    margin-top:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    border-radius:14px; padding:14px;
    border:1px solid rgba(255,255,255,0.03);
    overflow:hidden; position:relative; z-index:5;
  }
  .hero .title { font-family:'Playfair Display', serif; font-size:20px; margin:0 0 6px 0; color:#fff; }
  .hero .lead { color:var(--muted); font-size:13px; margin:0 0 10px 0; }
  .hero .cta-row { display:flex; gap:8px; align-items:center; }

  .cta {
    padding:10px 12px; border-radius:12px; font-weight:800; cursor:pointer; background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#071016; border:none;
    box-shadow: 0 14px 40px rgba(212,175,55,0.12), inset 0 -2px 6px rgba(0,0,0,0.2);
  }
  .ghost-cta { background:transparent; border:1px solid rgba(255,255,255,0.04); color:#fff; padding:10px 12px; border-radius:12px; }

  /* hero morph blob (SVG) */
  .hero-blob { position:absolute; right:-20px; top:-30px; width:220px; height:220px; opacity:0.12; filter: blur(22px) saturate(1.1); transform: rotate(18deg); pointer-events:none; }

  /* search + filters (mobile) */
  .search { margin-top:12px; display:flex; gap:8px; align-items:center; }
  .search input { flex:1; padding:12px 14px; border-radius:12px; background: rgba(255,255,255,0.02); border:none; color:#fff; outline:none; box-shadow: inset 0 -6px 28px rgba(0,0,0,0.6); font-size:15px; }

  .chips { margin-top:12px; display:flex; gap:8px; overflow-x:auto; padding-bottom:6px; -webkit-overflow-scrolling:touch; }
  .chip { flex:0 0 auto; padding:8px 12px; background:transparent; border-radius:999px; border:1px solid rgba(255,255,255,0.03); color:var(--muted); font-weight:700; cursor:pointer; white-space:nowrap; }
  .chip.active { color:var(--accent); transform:translateY(-4px); box-shadow: 0 16px 50px rgba(212,175,55,0.06); background: linear-gradient(90deg, rgba(212,175,55,0.08), rgba(212,175,55,0.03)); }

  /* progress bar at top for scroll */
  .progress-wrap { position:fixed; left:12px; right:12px; top:76px; height:4px; z-index:60; border-radius:999px; overflow:hidden; pointer-events:none; }
  .progress { height:100%; background: linear-gradient(90deg,var(--accent),var(--accent-2)); width:0%; transform-origin:left; transition: width .12s linear; box-shadow: 0 6px 18px rgba(212,175,55,0.12); }

  /* grid (single column mobile) */
  main.grid { margin-top:14px; display:grid; gap:12px; grid-template-columns:1fr; z-index:5; }
  @media(min-width:620px){ main.grid { grid-template-columns: repeat(2,1fr); } }
  @media(min-width:980px){ main.grid { grid-template-columns: repeat(3,1fr); } }

  /* card advanced */
  .card {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.008));
    border-radius:14px; overflow:hidden; border:1px solid rgba(255,255,255,0.03); min-height:280px; position:relative;
    transform-origin:center; will-change:transform;
  }
  .card .media { height:160px; position:relative; overflow:hidden; }
  .card img { width:100%; height:100%; object-fit:cover; display:block; transition: transform .9s cubic-bezier(.2,.9,.2,1), filter .45s ease; will-change:transform; }
  .card .sheen { position:absolute; left:-30%; top:-40%; width:160%; height:160%; mix-blend-mode:overlay; opacity:0; transition: opacity .6s ease, transform 1.2s ease; pointer-events:none; background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); transform: rotate(12deg) translateX(-10%); filter: blur(10px); }
  .card:hover .sheen { opacity:0.9; transform: rotate(12deg) translateX(8%); }

  .card-body { padding:12px; display:flex; flex-direction:column; gap:8px; min-height:120px; }
  .card-title { font-weight:800; font-size:16px; margin:0; color:#fff; }
  .card-sub { color:var(--muted); font-size:13px; }
  .card-price { color:var(--accent); font-weight:900; font-size:15px; }

  .card-meta { display:flex; justify-content:space-between; align-items:center; gap:8px; margin-top:auto; }
  .stars { display:flex; gap:6px; align-items:center; color:var(--accent); }
  .star-btn { background:transparent; border:none; font-size:16px; color:inherit; cursor:pointer; padding:6px; }

  .action-btns { display:flex; gap:8px; }
  .icon-btn { background:rgba(0,0,0,0.36); border-radius:10px; padding:8px; border:none; color:#fff; cursor:pointer; }

  /* shimmer text loop */
  .shine { position:relative; overflow:hidden; display:inline-block; }
  .shine::after { content:""; position:absolute; left:-120%; top:0; width:120%; height:100%; background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0.18), rgba(255,255,255,0)); transform:skewX(-12deg); animation: shine 2.2s linear infinite; pointer-events:none; opacity:0.9; }
  @keyframes shine { 0%{ left:-120% } 100%{ left:220% } }

  /* ripple */
  .ripple { position:absolute; border-radius:50%; transform:scale(0); pointer-events:none; background: radial-gradient(circle, rgba(212,175,55,0.22) 0%, rgba(212,175,55,0.08) 40%, transparent 60%); }

  /* skeleton loading */
  .skeleton { background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.04), rgba(255,255,255,0.02)); background-size:200% 100%; animation: shimmer 1.6s linear infinite; border-radius:12px; height:140px; }
  @keyframes shimmer { from { background-position:200% 0 } to { background-position:-200% 0 } }

  /* toast */
  .toast { position:fixed; left:50%; transform:translateX(-50%); bottom:24px; z-index:80; background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#061018; padding:10px 14px; border-radius:12px; font-weight:800; opacity:0; transition: opacity .2s ease; box-shadow: 0 18px 54px rgba(0,0,0,0.6); }
  .toast.show { opacity:1; }

  /* reduced motion fallbacks */
  @media (prefers-reduced-motion: reduce) {
    * { animation:none !important; transition:none !important; }
    .shine::after { display:none; }
    canvas#ambient { display:none; }
  }
</style>
</head>
<body>
  <canvas id="ambient"></canvas>

  <div class="app" id="app" role="application" aria-label="Bengt's Wish List mobile">
    <header class="app-header" role="banner">
      <div class="brand" aria-hidden="false">
        <h1 id="brandTitle">Bengt’s Wish List</h1>
        <p id="brandSub">Mobile Ultimate Motion</p>
      </div>

      <div class="controls" role="toolbar" aria-label="Aktionen">
        <label class="motion-toggle" title="Animationen ein/aus">
          <input id="motionToggle" type="checkbox" checked aria-checked="true" />
        </label>
        <button class="btn" id="editToggleBtn" aria-pressed="false">Bearbeiten</button>
        <button class="btn" id="addBtn" aria-hidden="true" style="display:none;">+ Hinzufügen</button>
        <button class="btn ghost" id="shareBtn">Teilen</button>
      </div>
    </header>

    <!-- progress bar -->
    <div class="progress-wrap" aria-hidden="true"><div class="progress" id="progress"></div></div>

    <!-- Hero / Intro -->
    <section class="hero" id="hero" role="region" aria-label="Intro">
      <svg class="hero-blob" viewBox="0 0 200 200" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
        <defs><linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#d4af37"/><stop offset="1" stop-color="#ffd87a"/></linearGradient></defs>
        <path id="blob" fill="url(#g1)" d="M40.8,-62.2C53.7,-52.3,67.8,-43.1,73.6,-29.1C79.4,-15.0,76.9,4.0,69.6,20.6C62.3,37.2,50.3,51.5,34.3,59.1C18.3,66.8,-1.5,67.8,-18.7,61.9C-35.9,56.1,-50.6,43.5,-59.7,27.8C-68.9,12.2,-72.5,-7.6,-66.4,-24.7C-60.2,-41.8,-44.3,-56.2,-26.4,-64.0C-8.4,-71.8,11.7,-73.4,29.4,-69.2C47,-65.1,63.9,-56.2,40.8,-62.2Z" transform="translate(100 100)" />
      </svg>

      <h2 class="title" id="introTitle">Willkommen, <span class="shine">Bengt</span></h2>
      <p class="lead">Deine kuratierte Wunschliste — luxuriös animiert, mobil-optimiert.</p>

      <div class="cta-row">
        <button class="cta" id="openBtn">Los geht's</button>
        <button class="ghost-cta" id="previewBtn">Vorschau</button>
      </div>
    </section>

    <!-- Search -->
    <div class="search" role="search" aria-label="Suche">
      <input id="searchInput" placeholder="Suchen (Name, Kategorie)..." inputmode="search" />
      <select id="sortSelect" style="padding:12px; border-radius:10px; background:transparent; color:#fff; border:1px solid rgba(255,255,255,0.03);">
        <option value="recent">Neueste</option>
        <option value="priority">Priorität</option>
        <option value="price-asc">Preis aufsteigend</option>
        <option value="price-desc">Preis absteigend</option>
      </select>
    </div>

    <!-- Chips -->
    <div class="chips" role="navigation" aria-label="Kategorien">
      <button class="chip active" data-cat="alle">Alle</button>
      <button class="chip" data-cat="priorität">Priorität</button>
      <button class="chip" data-cat="mode">Mode/Schmuck</button>
      <button class="chip" data-cat="technik">Technik</button>
      <button class="chip" data-cat="pflege">Pflege</button>
      <button class="chip" data-cat="sport">Sport</button>
      <button class="chip" data-cat="sonstiges">Sonstiges</button>
    </div>

    <!-- Product grid -->
    <main id="productGrid" class="grid" role="list" aria-live="polite" aria-label="Produkte">
      <!-- initial skeletons -->
      <div class="skeleton" role="status" aria-hidden="true"></div>
      <div class="skeleton" role="status" aria-hidden="true"></div>
      <div class="skeleton" role="status" aria-hidden="true"></div>
    </main>

  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

<script type="module">
/* ================================
   Ultimate Mobile Motion - Implementation
   All 30 ideas integrated:
   - Intro animations (stagger, blur-to-sharp, gradient, shape morph)
   - ScrollTrigger reveals, pinning, progress bar
   - 3D card tilt, sheen, layered parallax
   - Ambient canvas particles reacting to touch
   - Ripples, magnetic buttons, animated icons, text shine loop
   - Skeletons, lazy-loading, price shimmer, delete burst
   - Reduced-motion support + motion toggle
   ================================ */

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getDatabase, ref, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

/* ---------- Firebase config (replace if needed) ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyAmGhT9CjCMoICHA-B6w28_eGZqsq7dfpM",
  authDomain: "bengts-wishlist.firebaseapp.com",
  databaseURL: "https://bengts-wishlist-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "bengts-wishlist",
  storageBucket: "bengts-wishlist.appspot.com",
  messagingSenderId: "292890468669",
  appId: "1:292890468669:web:1cd0a2399d99c00d10e554",
  measurementId: "G-PYPF76P6Z2"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const dbRoot = ref(db, 'wishlist');

/* ---------- Helpers ---------- */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const clamp = (v,a,b) => Math.max(a, Math.min(b, v));
const toastEl = $('#toast');
let toastTimer = null;
function showToast(msg, ms=2200){ clearTimeout(toastTimer); toastEl.textContent = msg; toastEl.classList.add('show'); toastTimer = setTimeout(()=> toastEl.classList.remove('show'), ms); }
function isValidUrl(u){ try{ if(!u) return false; new URL(u); return true;}catch(e){return false;} }

/* ---------- Motion control & reduced motion ---------- */
const motionToggle = $('#motionToggle');
function setReducedMotion(disabled){
  if(disabled) document.documentElement.setAttribute('data-reduced','1');
  else document.documentElement.removeAttribute('data-reduced');
}
motionToggle.addEventListener('change', (e)=> {
  const on = e.target.checked;
  setReducedMotion(!on);
  showToast(on ? 'Motion aktiviert' : 'Motion deaktiviert');
});
setReducedMotion(false);

/* ---------- Ambient Canvas Particles (interactive) - Idea #25 & #1 background ---------- */
(function ambient(){
  const canvas = document.getElementById('ambient');
  const ctx = canvas.getContext('2d');
  let w = canvas.width = innerWidth, h = canvas.height = innerHeight;
  let blobs = [];
  const maxBlobs = 20;

  function rand(min,max){ return Math.random()*(max-min)+min; }
  function resize(){ w = canvas.width = innerWidth; h = canvas.height = innerHeight; init(); }
  function init(){
    blobs = [];
    for(let i=0;i<maxBlobs;i++){
      blobs.push({
        x: rand(-0.2*w, 1.2*w),
        y: rand(-0.2*h, 1.2*h),
        r: rand(80,220),
        vx: rand(-0.12,0.12),
        vy: rand(-0.06,0.06),
        hue: 28 + rand(-6,24),
        alpha: rand(0.03,0.08),
        phase: rand(0,Math.PI*2)
      });
    }
  }
  function step(){
    if(document.documentElement.getAttribute('data-reduced') === '1'){ ctx.clearRect(0,0,w,h); requestAnimationFrame(step); return; }
    ctx.clearRect(0,0,w,h);
    ctx.globalCompositeOperation = 'lighter';
    for(const b of blobs){
      b.x += b.vx; b.y += b.vy; b.phase += 0.002;
      const g = ctx.createRadialGradient(b.x, b.y, b.r*0.12, b.x, b.y, b.r);
      const a = b.alpha * (0.85 + Math.sin(b.phase)*0.15);
      g.addColorStop(0, `hsla(${b.hue},85%,60%,${a})`);
      g.addColorStop(0.45, `hsla(${b.hue+6},78%,48%,${a*0.6})`);
      g.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = g;
      ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill();
      // wrap-around
      if(b.x < -0.3*w) b.x = 1.3*w;
      if(b.x > 1.3*w) b.x = -0.3*w;
      if(b.y < -0.3*h) b.y = 1.3*h;
      if(b.y > 1.3*h) b.y = -0.3*h;
    }
    requestAnimationFrame(step);
  }
  addEventListener('resize', resize);
  // interaction: subtle parallax on pointermove
  addEventListener('pointermove', (e)=>{
    if(document.documentElement.getAttribute('data-reduced') === '1') return;
    const mx = e.clientX / innerWidth; const my = e.clientY / innerHeight;
    for(let i=0;i<blobs.length;i++){
      blobs[i].x += (mx - 0.5) * (i%2===0 ? 2.0 : 1.0);
      blobs[i].y += (my - 0.5) * (i%3===0 ? 1.2 : 0.6);
    }
  }, { passive:true });
  resize(); step();
})();

/* ---------- Intro timeline (Start animation) - Ideas 1,2,3,4,6,7,8 ----------
   - blur-to-sharp, gradient fade, text stagger, card cascade (cards appear later)
   - morph blob SVG using simple path interpolation (approx)
*/
gsap.registerPlugin(window.ScrollTrigger);

const introTimeline = gsap.timeline({ defaults: { ease: "expo.out" } });

function introAnimation(){
  if(document.documentElement.getAttribute('data-reduced') === '1') return;
  const brand = $('#brandTitle'), sub = $('#brandSub'), hero = $('#hero'), open = $('#openBtn');
  // initial states
  gsap.set([brand, sub, hero, open], { opacity:0, y:18, filter:"blur(6px)" });
  // gradient fade and blur-to-sharp
  introTimeline
    .to('#blob', { duration: 1.6, attr: { d: morphPath1() }, ease: "elastic.out(1.0, 0.7)" }, 0.0)
    .to(brand, { opacity:1, y:0, filter:"blur(0px)", duration:0.9 }, 0.15)
    .to(sub, { opacity:1, y:0, filter:"blur(0px)", duration:0.9 }, 0.25)
    .from(".title .shine", { opacity:0, y:6, stagger:0.06, duration:0.9 }, 0.35)
    .to(hero, { opacity:1, y:0, filter:"blur(0px)", duration:1.0 }, 0.3)
    .from("#openBtn", { scale:0.84, opacity:0, duration:0.9, ease:"elastic.out(1,0.6)", delay:0.15 }, 0.6);
}

// simple morph variant path generator (returns string). For premium result you'd use flubber/libraries.
// We'll produce a slightly different path to simulate morph (idea 7).
function morphPath1(){
  // smaller variation
  return "M38.6,-58.2C52.2,-49.7,66.5,-40.9,73.1,-27.6C79.7,-14.4,78.7,3.4,71.2,18.8C63.7,34.2,49.7,47.2,33.8,56.1C17.9,64.9,-0.0,69.5,-17.3,65.1C-34.6,60.6,-50.3,46.9,-60.6,31.6C-70.8,16.3,-75.6,-1.5,-70,-16.7C-64.4,-31.9,-48.6,-44.6,-31.4,-53.0C-14.1,-61.4,4.6,-65.6,20.9,-62.6C37.2,-59.6,24.9,-66.8,38.6,-58.2Z";
}

/* ---------- SVG blob subtle morph loop (idea 7) ---------- */
(function blobMorphLoop(){
  if(document.documentElement.getAttribute('data-reduced') === '1') return;
  const blob = document.getElementById('blob');
  if(!blob) return;
  gsap.to(blob, { attr:{ d: morphPath1() }, duration: 10, repeat: -1, yoyo: true, ease: "sine.inOut" });
})();

/* ---------- Progress bar on scroll (idea 10) ---------- */
const progress = $('#progress');
window.addEventListener('scroll', () => {
  const docH = document.documentElement.scrollHeight - innerHeight;
  const pct = docH <= 0 ? 0 : (window.scrollY / docH) * 100;
  progress.style.width = pct + '%';
});

/* ---------- Fetch & render products (Firebase) + skeletons (idea 30) ---------- */
const productGrid = $('#productGrid');
let productsCache = {}; // key->product

function renderSkeletons(){
  productGrid.innerHTML = '';
  for(let i=0;i<3;i++){
    const s = document.createElement('div'); s.className='skeleton'; productGrid.appendChild(s);
  }
}
renderSkeletons();

onValue(dbRoot, snapshot => {
  const data = snapshot.val() || {};
  productsCache = Object.keys(data).reduce((acc,k)=> { acc[k] = { key:k, ...data[k] }; return acc; }, {});
  renderProducts(Object.values(productsCache));
});

/* ---------- Render products with many effects integrated ---------- */
function renderProducts(list){
  productGrid.innerHTML = '';
  if(!list || list.length === 0){
    const p = document.createElement('p'); p.textContent = 'Keine Produkte vorhanden'; p.style.color = 'var(--muted)'; productGrid.appendChild(p);
    return;
  }
  // sort: newest first
  list.sort((a,b)=> String(b.key).localeCompare(String(a.key)));
  list.forEach((p, idx) => {
    const card = document.createElement('article');
    card.className = 'card';
    card.setAttribute('role','article');
    card.style.zIndex = 10;

    // inner structure
    const media = document.createElement('div'); media.className = 'media';
    const img = document.createElement('img'); img.alt = p.name || 'Produktbild';
    img.loading = 'lazy'; img.decoding = 'async';
    img.src = p.imgUrl || 'https://via.placeholder.com/900x500?text=Kein+Bild';
    media.appendChild(img);
    const sheen = document.createElement('div'); sheen.className = 'sheen';
    media.appendChild(sheen);
    card.appendChild(media);

    const body = document.createElement('div'); body.className = 'card-body';
    const title = document.createElement('div'); title.className = 'card-title';
    if(p.link && isValidUrl(p.link)){
      const a = document.createElement('a'); a.href = p.link; a.textContent = p.name || 'Unbenannt'; a.target = '_blank'; a.rel='noopener noreferrer'; a.style.color='inherit'; a.style.textDecoration='none';
      title.appendChild(a);
    } else { title.textContent = p.name || 'Unbenannt'; }
    body.appendChild(title);

    const sub = document.createElement('div'); sub.className = 'card-sub'; sub.textContent = p.category || 'Sonstiges'; body.appendChild(sub);

    const price = document.createElement('div'); price.className = 'card-price'; price.textContent = p.price || ''; body.appendChild(price);

    const meta = document.createElement('div'); meta.className = 'card-meta';
    const left = document.createElement('div');
    left.style.display = 'flex'; left.style.alignItems='center'; left.style.gap='8px';
    const chip = document.createElement('div'); chip.className='chip'; chip.textContent = p.category || 'sonstiges'; chip.style.padding='6px'; chip.style.fontSize='12px';
    left.appendChild(chip);

    // stars (keyboard accessible) - idea 16, 22
    const stars = document.createElement('div'); stars.className='stars';
    for(let s=1;s<=5;s++){
      const st = document.createElement('button'); st.className='star-btn'; st.innerHTML = s <= (p.priority||0) ? '★' : '☆';
      st.setAttribute('aria-pressed', s <= (p.priority||0));
      st.title = `Priorität ${s}`;
      st.addEventListener('click', ()=> {
        if(!editMode){ showToast('Aktiviere Bearbeitungsmodus zum Setzen der Priorität'); return; }
        update(ref(db, `wishlist/${p.key}`), { priority: s }).then(()=> showToast('Priorität gesetzt'));
        navigator.vibrate?.(40); // subtle haptic on supported devices (idea 29)
      });
      st.addEventListener('keydown', e => { if(e.key==='Enter' || e.key===' ') { e.preventDefault(); st.click(); } });
      stars.appendChild(st);
    }
    left.appendChild(stars);
    meta.appendChild(left);

    // actions (right)
    const actions = document.createElement('div'); actions.className='action-btns';
    const editBtn = document.createElement('button'); editBtn.className='icon-btn'; editBtn.innerHTML='✎'; editBtn.title='Bearbeiten';
    editBtn.addEventListener('click', ()=> {
      if(!editMode){ showToast('Aktiviere Bearbeitungsmodus'); return; }
      // superfast inline edit modal
      const newName = prompt('Produktname', p.name);
      if(newName === null) return;
      update(ref(db, `wishlist/${p.key}`), { name: newName }).then(()=> showToast('Produkt aktualisiert'));
    });
    const delBtn = document.createElement('button'); delBtn.className='icon-btn'; delBtn.innerHTML='🗑'; delBtn.title='Löschen';
    delBtn.addEventListener('click', async ()=> {
      if(!editMode){ showToast('Aktiviere Bearbeitungsmodus'); return; }
      if(!confirm(`Produkt "${p.name}" löschen?`)) return;
      await remove(ref(db, `wishlist/${p.key}`));
      deleteBurst(delBtn); // confetti-like burst (idea 15/??)
    });

    actions.appendChild(editBtn); actions.appendChild(delBtn);
    meta.appendChild(actions);

    body.appendChild(meta);
    card.appendChild(body);

    // ripple effect on tap (idea 22)
    card.addEventListener('pointerdown', (ev) => {
      if(document.documentElement.getAttribute('data-reduced') === '1') return;
      const r = document.createElement('div'); r.className='ripple';
      const rect = card.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height) * 1.4;
      r.style.width = r.style.height = size + 'px';
      r.style.left = (ev.clientX - rect.left - size/2) + 'px';
      r.style.top = (ev.clientY - rect.top - size/2) + 'px';
      card.appendChild(r);
      r.animate([{ transform:'scale(0)', opacity:0.9 }, { transform:'scale(1.6)', opacity:0 }], { duration:700, easing:'cubic-bezier(.2,.9,.2,1)' });
      setTimeout(()=> r.remove(), 900);
      // magnetic button idea: slight pull
      if(ev.pointerType === 'touch') navigator.vibrate?.(8);
    });

    // 3D tilt for pointer (idea 16 + 19 + 21)
    card.addEventListener('pointermove', e => {
      if(document.documentElement.getAttribute('data-reduced') === '1') { card.style.transform=''; return; }
      const rect = card.getBoundingClientRect();
      const cx = rect.left + rect.width/2;
      const cy = rect.top + rect.height/2;
      const dx = (e.clientX - cx) / rect.width;
      const dy = (e.clientY - cy) / rect.height;
      const rx = clamp(-dy * 12, -15, 15);
      const ry = clamp(dx * 12, -15, 15);
      // transform only on performant properties
      card.style.transform = `perspective(800px) rotateX(${rx}deg) rotateY(${ry}deg) translateZ(4px)`;
      // dynamic shadow: idea 18
      card.style.boxShadow = `${-ry*2}px ${rx*2}px 30px rgba(0,0,0,0.45), 0 12px 36px rgba(0,0,0,0.35)`;
      // sheen move
      sheen.style.transform = `rotate(12deg) translateX(${clamp(dx*40, -40, 40)}%)`;
      sheen.style.opacity = 0.9;
    });
    card.addEventListener('pointerleave', ()=> {
      card.style.transform = ''; card.style.boxShadow = ''; sheen.style.transform = 'rotate(12deg) translateX(-10%)'; sheen.style.opacity = 0;
    });

    // simple layered parallax inside card: image moves little on scroll into view (idea 21)
    const observer = new IntersectionObserver(entries => {
      entries.forEach(en => {
        if(en.isIntersecting){
          gsap.to(img, { scale:1.06, duration:1.8, ease:"power2.out" });
        } else {
          gsap.to(img, { scale:1.0, duration:1.2, ease:"power2.out" });
        }
      });
    }, { threshold: [0, 0.35, 0.8]});
    observer.observe(card);

    // add to DOM with small stagger (idea 4 cascade)
    productGrid.appendChild(card);
    // entrance animation (stagger)
    const delay = (idx % 6) * 0.06;
    if(document.documentElement.getAttribute('data-reduced') !== '1'){
      gsap.from(card, { y: 24, opacity:0, scale: 0.995, duration: 0.7, delay: delay, ease: "power3.out" });
    }
  });
}

/* ---------- Delete burst (confetti-like) ---------- */
function deleteBurst(el){
  if(document.documentElement.getAttribute('data-reduced') === '1') return;
  const rect = el.getBoundingClientRect();
  const parent = document.body;
  for(let i=0;i<14;i++){
    const dot = document.createElement('div');
    dot.style.position='fixed'; dot.style.left = (rect.left + rect.width/2) + 'px'; dot.style.top = (rect.top + rect.height/2) + 'px';
    dot.style.width = dot.style.height = (6 + Math.random()*10) + 'px';
    dot.style.borderRadius='50%'; dot.style.zIndex = 9999;
    dot.style.background = i%2===0 ? 'rgba(212,175,55,0.95)' : 'rgba(255,216,120,0.95)';
    parent.appendChild(dot);
    const dx = (Math.random()-0.5)*300;
    const dy = -80 - Math.random()*260;
    dot.animate([{ transform:'translate(0,0) scale(1)', opacity:1 }, { transform:`translate(${dx}px, ${dy}px) scale(0.6)`, opacity:0 }], { duration: 900 + Math.random()*600, easing:'cubic-bezier(.2,.9,.2,1)' });
    setTimeout(()=> dot.remove(), 1600);
  }
}

/* ---------- Magnetic buttons (idea 26) ----------
   For small CTA buttons, using pointermove to slightly translate button towards pointer.
*/
function magneticSetup(){
  const btns = [$('#openBtn'), $('#previewBtn')].filter(Boolean);
  btns.forEach(btn => {
    let rect;
    btn.addEventListener('pointerenter', () => rect = btn.getBoundingClientRect());
    btn.addEventListener('pointermove', (e) => {
      if(document.documentElement.getAttribute('data-reduced') === '1') return;
      const dx = (e.clientX - (rect.left + rect.width/2)) / rect.width;
      const dy = (e.clientY - (rect.top + rect.height/2)) / rect.height;
      gsap.to(btn, { x: dx*8, y: dy*6, duration: 0.22, ease: "power3.out" });
    });
    btn.addEventListener('pointerleave', () => gsap.to(btn, { x:0, y:0, duration:0.25, ease:"power3.out" }));
  });
}

/* ---------- Text shimmer loop (idea 28/24) ---------- */
function textShineLoop(){
  // Add .shine class already applied in markup for "Bengt"
  // If reduced-motion -> do nothing
}

/* ---------- Scroll-triggered section reveals & pinning (ideas 9,11,12,13,14,15) ---------- */
function setupScrollTriggers(){
  // stagger reveal of cards when scrolling
  gsap.utils.toArray('.card').forEach((c, i) => {
    ScrollTrigger.create({
      trigger: c,
      start: 'top 85%',
      onEnter: () => gsap.to(c, { opacity:1, y:0, scale:1, duration:0.8, ease:"power3.out" }),
      onEnterBack: () => gsap.to(c, { opacity:1, y:0, scale:1, duration:0.6, ease:"power3.out" })
    });
  });

  // pin hero while intro (sequential storytelling)
  ScrollTrigger.create({ trigger:'#hero', start:'top top', end:'+=200', pin: '#hero', pinSpacing:false, scrub:0.6 });
}

/* ---------- Initial wiring ---------- */
let editMode = false;
$('#editToggleBtn').addEventListener('click', ()=>{
  if(!editMode){
    const pw = prompt('Passwort zum Bearbeiten eingeben (UI-only):');
    if(pw === null) return;
    if(pw !== 'Qp123567s7K!'){ alert('Falsches Passwort'); return; }
    editMode = true; $('#editToggleBtn').setAttribute('aria-pressed','true'); $('#editToggleBtn').textContent = 'Bearbeiten (an)'; $('#addBtn').style.display = 'inline-flex';
    showToast('Bearbeiten aktiviert');
  } else {
    editMode = false; $('#editToggleBtn').setAttribute('aria-pressed','false'); $('#editToggleBtn').textContent = 'Bearbeiten'; $('#addBtn').style.display = 'none';
    showToast('Bearbeiten beendet');
  }
});

/* Add product quick */
$('#addBtn').addEventListener('click', async ()=>{
  if(!editMode){ showToast('Aktiviere Bearbeitungsmodus'); return; }
  const name = prompt('Produktname (Pflicht)'); if(!name) return;
  const price = prompt('Preis (optional)');
  const link = prompt('Shop URL (optional)');
  const img = prompt('Bild URL (optional)');
  const cat = prompt('Kategorie (Mode/Technik...)','sonstiges') || 'sonstiges';
  const priority = Math.max(0, Math.min(5, Number(prompt('Priorität 0-5','0')) || 0));
  await push(dbRoot, { name, price, link, imgUrl: img, category: cat.toLowerCase(), priority });
  showToast('Produkt hinzugefügt');
});

/* Share button (Web Share or WA) */
$('#shareBtn').addEventListener('click', async ()=>{
  const url = location.href; const text = 'Schau dir meine Wunschliste an:';
  if(navigator.share){ try{ await navigator.share({ title:'Bengt’s Wish List', text, url }); showToast('Teilen geöffnet'); }catch(e){ showToast('Teilen abgebrochen'); } }
  else { window.open(`https://wa.me/?text=${encodeURIComponent(text + ' ' + url)}`,'_blank'); }
});

/* Search + chips */
$('#searchInput').addEventListener('input', (e)=>{
  const q = e.target.value.trim().toLowerCase();
  const arr = Object.values(productsCache).filter(p => (p.name||'').toLowerCase().includes(q) || (p.category||'').toLowerCase().includes(q));
  renderProducts(arr);
});
$$('.chip').forEach(chip => chip.addEventListener('click', (e)=>{
  $$('.chip').forEach(c => c.classList.remove('active'));
  e.currentTarget.classList.add('active');
  const cat = e.currentTarget.dataset.cat;
  if(cat === 'alle') renderProducts(Object.values(productsCache));
  else if(cat === 'priorität') renderProducts(Object.values(productsCache).filter(x => (x.priority||0) > 0));
  else renderProducts(Object.values(productsCache).filter(x => (x.category||'').toLowerCase() === cat));
}));

/* sort select */
$('#sortSelect').addEventListener('change', (e)=>{
  const v = e.target.value;
  const arr = Object.values(productsCache).slice();
  if(v === 'priority') arr.sort((a,b)=> (b.priority||0)-(a.priority||0));
  else if(v === 'price-asc') arr.sort((a,b)=> (parseFloat((a.price||'').replace(/[^\d\.,-]/g,''))||0) - (parseFloat((b.price||'').replace(/[^\d\.,-]/g,''))||0));
  else if(v === 'price-desc') arr.sort((a,b)=> (parseFloat((b.price||'').replace(/[^\d\.,-]/g,''))||0) - (parseFloat((a.price||'').replace(/[^\d\.,-]/g,''))||0));
  else arr.sort((a,b)=> String(b.key).localeCompare(String(a.key)));
  renderProducts(arr);
});

/* Magnetic buttons */
magneticSetup();

/* Setup Scroll triggers after some delay (to ensure .card exist) */
setTimeout(()=> { setupScrollTriggers(); introAnimation(); textShineLoop(); }, 850);

/* small throttle to re-run scroll triggers on resize */
let rr; addEventListener('resize', ()=> { clearTimeout(rr); rr = setTimeout(()=> { ScrollTrigger.refresh(); }, 300); });

/* initial toast */
showToast('Premium Mobile Motion geladen — viel Spaß!');

</script>
</body>
</html>
